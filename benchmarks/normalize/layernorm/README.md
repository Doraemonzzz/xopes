# SRMSNORM benchmark

## Notation

- tr: Triton
- to: Torch
- toc: Torch Compile

## H100

### With Residual

#### Speed

```
layernorm-speed-fwd-batch4-dim2048-use_residual_True-bf16:
         n        tr        to       toc
0   1024.0  0.175236  0.382101  0.125448
1   2048.0  0.147751  0.692909  0.108993
2   4096.0  0.146303  1.320690  0.141711
3   8192.0  0.185345  2.543417  0.186136
4  16384.0  0.361125  4.994867  0.361557
5  32768.0  0.714824  9.890996  0.716973

layernorm-speed-bwd-batch4-dim2048-use_residual_True-bf16:
         n        tr         to       toc
0   1024.0  0.725660   1.010296  0.647420
1   2048.0  0.848706   1.295809  0.729688
2   4096.0  0.878090   2.442812  1.212039
3   8192.0  0.848135   4.708949  1.110651
4  16384.0  1.616344   9.226560  1.715465
5  32768.0  3.151938  18.271902  3.397331
```

#### Memory

```
layernorm-memory-fwd-batch4-dim2048-use_residual_True-bf16:
         n           tr           to          toc
0   1024.0    64.039062   224.039062    64.039062
1   2048.0   128.070312   448.054688   128.070312
2   4096.0   256.132812   896.085938   256.132812
3   8192.0   512.257812  1792.148438   512.257812
4  16384.0  1024.507812  3584.273438  1024.507812
5  32768.0  2049.007812  7168.523438  2049.007812

layernorm-memory-bwd-batch4-dim2048-use_residual_True-bf16:
         n           tr            to          toc
0   1024.0   254.454785    350.454785   174.454297
1   2048.0   508.886035    700.870410   348.885547
2   4096.0   893.748535   1401.701172   697.748047
3   8192.0  1655.473535   2803.363672  1395.473047
4  16384.0  3178.923535   5606.688672  2790.923047
5  32768.0  6225.823535  11213.338672  5581.823047
```

### Without Residual

#### Speed
```
layernorm-speed-fwd-batch4-dim2048-use_residual_False-bf16:
         n        tr        to       toc
0   1024.0  0.169096  0.285637  0.152741
1   2048.0  0.125858  0.514308  0.145068
2   4096.0  0.197126  0.978648  0.130752
3   8192.0  0.148340  1.878389  0.142192
4  16384.0  0.185676  3.677489  0.274431
5  32768.0  0.360767  7.273176  0.541279
layernorm-speed-bwd-batch4-dim2048-use_residual_False-bf16:
         n        tr         to       toc
0   1024.0  0.669279   0.982024  1.082426
1   2048.0  0.512146   1.211628  0.577460
2   4096.0  0.811897   2.279838  0.860964
3   8192.0  0.676555   4.377657  0.792143
4  16384.0  1.113598   8.575860  0.960659
5  32768.0  1.990134  16.982586  1.882587
```

#### Memory
```
layernorm-memory-fwd-batch4-dim2048-use_residual_False-bf16:
         n           tr           to          toc
0   1024.0    32.039062   208.039062    32.039062
1   2048.0    64.070312   416.054688    64.070312
2   4096.0   128.132812   832.085938   128.132812
3   8192.0   256.257812  1664.148438   256.257812
4  16384.0   512.507812  3328.273438   512.507812
5  32768.0  1025.007812  6656.523438  1025.007812

layernorm-memory-bwd-batch4-dim2048-use_residual_False-bf16:
         n           tr            to          toc
0   1024.0   207.254785    319.254785   111.254297
1   2048.0   414.486035    638.470410   222.485547
2   4096.0   704.948535   1276.901172   444.948047
3   8192.0  1277.873535   2553.763672   889.873047
4  16384.0  2423.723535   5107.488672  1779.723047
5  32768.0  4715.423535  10214.938672  3559.423047
```
