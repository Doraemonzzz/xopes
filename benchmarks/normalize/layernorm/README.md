# SRMSNORM benchmark

## Notation

- tr: Triton
- to: Torch
- toc: Torch Compile

## H100

### With Residual

#### Speed

```
layernorm-speed-fwd-batch4-dim2048-use_residual_True-bf16:
         n        tr        to       toc
0   1024.0  0.128247  0.342391  0.101580
1   2048.0  0.108680  0.626377  0.103755
2   4096.0  0.148206  1.199880  0.153864
3   8192.0  0.183976  2.318743  0.224199
4  16384.0  0.359884  4.556658  0.388739
5  32768.0  0.713506  9.030763  0.771593

layernorm-speed-bwd-batch4-dim2048-use_residual_True-bf16:
         n        tr         to       toc
0   1024.0  0.261007   0.678152  0.268252
1   2048.0  0.404475   1.252515  0.673396
2   4096.0  0.412472   2.371310  0.448381
3   8192.0  0.773980   4.591144  0.861936
4  16384.0  1.501236   9.029709  1.687879
5  32768.0  2.965234  17.913069  3.342585
```

#### Memory

```
layernorm-memory-fwd-batch4-dim2048-use_residual_True-bf16:
         n           tr           to          toc
0   1024.0    64.035156   208.027344    64.035156
1   2048.0   128.066406   416.042969   128.066406
2   4096.0   256.128906   832.074219   256.128906
3   8192.0   512.253906  1664.136719   512.253906
4  16384.0  1024.503906  3328.261719  1024.503906
5  32768.0  2049.003906  6656.511719  2049.003906

layernorm-memory-bwd-batch4-dim2048-use_residual_True-bf16:
         n           tr            to          toc
0   1024.0   222.447168    350.439355   174.442773
1   2048.0   444.878418    700.854980   348.874023
2   4096.0   765.740918   1401.685742   697.736523
3   8192.0  1399.465918   2803.348242  1395.461523
4  16384.0  2666.915918   5606.673242  2790.911523
5  32768.0  5201.815918  11213.323242  5581.811523
```

### Without Residual

#### Speed
```
layernorm-speed-fwd-batch4-dim2048-use_residual_False-bf16:
         n        tr        to       toc
0   1024.0  0.103478  0.245631  0.112646
1   2048.0  0.093383  0.448052  0.086388
2   4096.0  0.128979  0.860100  0.089866
3   8192.0  0.167258  1.652745  0.137841
4  16384.0  0.184587  3.241457  0.266581
5  32768.0  0.360569  6.406227  0.524810

layernorm-speed-bwd-batch4-dim2048-use_residual_False-bf16:
         n        tr         to       toc
0   1024.0  0.410788   0.631201  0.590138
1   2048.0  0.603701   1.164066  1.034865
2   4096.0  0.578219   2.203175  1.405501
3   8192.0  0.663444   4.259929  0.491630
4  16384.0  0.913806   8.380396  0.951792
5  32768.0  1.796508  16.618862  1.874687
```

#### Memory
```
layernorm-memory-fwd-batch4-dim2048-use_residual_False-bf16:
         n           tr           to          toc
0   1024.0    32.035156   192.027344    32.035156
1   2048.0    64.066406   384.042969    64.066406
2   4096.0   128.128906   768.074219   128.128906
3   8192.0   256.253906  1536.136719   256.253906
4  16384.0   512.503906  3072.261719   512.503906
5  32768.0  1025.003906  6144.511719  1025.003906

layernorm-memory-bwd-batch4-dim2048-use_residual_False-bf16:
         n           tr            to          toc
0   1024.0   175.247168    319.239355   111.242773
1   2048.0   350.478418    638.454980   222.474023
2   4096.0   576.940918   1276.885742   444.936523
3   8192.0  1021.865918   2553.748242   889.861523
4  16384.0  1911.715918   5107.473242  1779.711523
5  32768.0  3691.415918  10214.923242  3559.411523
```
