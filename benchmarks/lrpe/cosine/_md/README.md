# Benchmark

## Notation

- Tri: Triton
- Tri Ca: Triton Cache
- Tor: Torch
- Tor C: Torch Compile

$-1$ indicate error.

## A800

### 1d

1d version, sequence length is $n$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-1d-l0:
         n       Tri    Tri Ca        Tor     Tor C
0    256.0  0.163323  0.169270   0.411781  0.206048
1    512.0  0.198294  0.202130   0.610906  0.330625
2   1024.0  0.250804  0.265823   0.920157  0.431945
3   2048.0  0.398941  0.386600   1.662961  0.700253
4   4096.0  0.621821  0.638041   3.188930  1.262792
5   8192.0  1.115549  1.152078   6.179524  2.382696
6  16384.0  2.078264  2.142212  12.185967  4.660357
7  32768.0  4.064563  4.196456  24.382385  9.197300

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-1d-l0:
         n          Tri       Tri Ca           Tor        Tor C
0    256.0    36.019043    37.519043     96.022949    37.520996
1    512.0    72.019043    75.019043    192.026855    75.022949
2   1024.0   144.019043   150.019043    384.034668   150.026855
3   2048.0   288.019043   300.019043    768.050293   300.034668
4   4096.0   576.019043   600.019043   1536.081543   600.050293
5   8192.0  1152.019043  1200.019043   3072.144043  1200.081543
6  16384.0  2304.019043  2400.019043   6144.269043  2400.144043
7  32768.0  4608.019043  4800.019043  12288.519043  4800.269043

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-1d-l0:
         n       Tri    Tri Ca        Tor     Tor C
0    256.0  0.155535  0.176801   0.250497  0.054322
1    512.0  0.099048  0.096647   0.507157  0.091144
2   1024.0  0.192676  0.181977   0.990053  0.168388
3   2048.0  0.377653  0.354661   2.035642  0.352043
4   4096.0  0.746958  0.699928   4.006361  0.711934
5   8192.0  1.484754  1.389856   7.940115  1.406732
6  16384.0  2.961293  2.769722  15.862609  2.796264
7  32768.0  5.960190  5.550381  31.715530  5.612435

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-1d-l0:
         n          Tri       Tri Ca           Tor        Tor C
0    256.0    71.569043    73.069043    137.568555    73.068555
1    512.0   143.119043   146.119043    275.118555   146.118555
2   1024.0   286.219043   292.219043    550.218555   292.218555
3   2048.0   572.419043   584.419043   1100.418555   584.418555
4   4096.0  1144.819043  1168.819043   2200.818555  1168.818555
5   8192.0  2289.619043  2337.619043   4401.618555  2337.618555
6  16384.0  4579.219043  4675.219043   8803.218555  4675.218555
7  32768.0  9158.419043  9350.419043  17606.418555  9350.418555
```

num extra token $l=10$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-1d-l10:
         n       Tri    Tri Ca        Tor     Tor C
0    256.0  0.161740  0.176735   0.494068  0.217221
1    512.0  0.196041  0.203490   0.706712  0.286963
2   1024.0  0.261750  0.269903   1.142890  0.435442
3   2048.0  0.378753  0.392495   2.091678  0.751403
4   4096.0  0.618155  0.645080   3.970725  1.318363
5   8192.0  1.103000  1.140384   7.750456  2.529507
6  16384.0  2.078072  2.135825  15.363130  4.865615
7  32768.0  4.002055  4.128171  30.654634  9.600323

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-1d-l10:
         n          Tri       Tri Ca           Tor        Tor C
0    256.0    37.425293    38.983887     99.429199    38.927246
1    512.0    73.425293    76.483887    195.433105    76.429199
2   1024.0   145.425293   151.483887    387.440918   151.433105
3   2048.0   289.425293   301.483887    771.456543   301.440918
4   4096.0   577.425293   601.483887   1539.487793   601.456543
5   8192.0  1153.425293  1201.483887   3075.550293  1201.487793
6  16384.0  2305.425293  2401.483887   6147.675293  2401.550293
7  32768.0  4609.425293  4801.483887  12291.925293  4801.675293

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-1d-l10:
         n       Tri    Tri Ca        Tor     Tor C
0    256.0  0.188331  0.192933   0.356172  0.086092
1    512.0  0.158702  0.122787   0.699061  0.123608
2   1024.0  0.231324  0.217040   1.332433  0.231511
3   2048.0  0.449422  0.419841   2.667959  0.456874
4   4096.0  0.886010  0.825570   5.222587  0.903714
5   8192.0  1.758219  1.636102  10.339890  1.782116
6  16384.0  3.504004  3.258821  20.639328  3.538119
7  32768.0  6.994319  6.503753  41.275406  7.053078

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-1d-l10:
         n          Tri       Tri Ca           Tor        Tor C
0    256.0    75.183105    76.741699    142.732617    76.682617
1    512.0   147.183105   150.241699    279.688867   150.182617
2   1024.0   292.081152   298.139746    556.614648   298.080664
3   2048.0   579.183105   591.241699   1105.582617   591.182617
4   4096.0  1155.183105  1179.241699   2205.982617  1179.182617
5   8192.0  2307.183105  2355.241699   4406.188867  2355.182617
6  16384.0  4611.183105  4707.241699   8808.382617  4707.182617
7  32768.0  9219.183105  9411.241699  17611.582617  9411.182617
```

### 2d

2d version, sequence length is $n^2$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-2d-l0:
       n       Tri    Tri Ca        Tor     Tor C
0   16.0  0.173097  0.194320   0.461715  0.239605
1   32.0  0.319235  0.321834   0.970538  0.496805
2   64.0  0.804922  0.891095   3.192215  1.207599
3  128.0  2.756350  3.007781  12.221272  4.239955

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-2d-l0:
       n          Tri       Tri Ca          Tor        Tor C
0   16.0    36.003906    37.503906    96.008789    37.504883
1   32.0   144.003906   150.003906   384.020508   150.004883
2   64.0   576.003906   600.003906  1536.067383   600.004883
3  128.0  2304.003906  2400.003906  6144.255859  2400.005859

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-2d-l0:
       n       Tri    Tri Ca        Tor     Tor C
0   16.0  0.124822  0.101551   0.250146  0.046555
1   32.0  0.238385  0.181948   0.988477  0.168456
2   64.0  0.931358  0.699624   4.006396  0.711846
3  128.0  3.697046  2.769088  15.863564  2.794075

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-2d-l0:
       n          Tri       Tri Ca          Tor        Tor C
0   16.0    71.553906    73.053906   137.553418    73.053418
1   32.0   286.203906   292.203906   550.203418   292.203418
2   64.0  1144.803906  1168.803906  2200.803418  1168.803418
3  128.0  4579.203906  4675.203906  8803.203418  4675.203418

```

num extra token $l=10$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-2d-l10:
       n       Tri    Tri Ca        Tor     Tor C
0   16.0  0.174123  0.213224   0.534455  0.259607
1   32.0  0.305096  0.362488   1.249691  0.480833
2   64.0  0.802414  0.879582   4.006236  1.379406
3  128.0  2.772220  3.027502  15.420235  4.989848

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-2d-l10:
       n          Tri      Tri Ca          Tor        Tor C
0   16.0    37.410156    38.96875    99.415039    38.911133
1   32.0   145.410156   151.46875   387.426758   151.411133
2   64.0   577.410156   601.46875  1539.473633   601.411133
3  128.0  2305.410156  2401.46875  6147.662109  2401.412109

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-2d-l10:
       n       Tri    Tri Ca        Tor     Tor C
0   16.0  0.165186  0.163504   0.358472  0.089704
1   32.0  0.275435  0.217235   1.335118  0.230896
2   64.0  1.057444  0.825610   5.226931  0.901540
3  128.0  4.188087  3.258659  20.653296  3.531142

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-2d-l10:
       n          Tri       Tri Ca         Tor       Tor C
0   16.0    75.167969    76.726562   142.71748    76.66748
1   32.0   291.167969   297.226562   555.36748   297.16748
2   64.0  1155.167969  1179.226562  2205.96748  1179.16748
3  128.0  4611.167969  4707.226562  8808.36748  4707.16748
```

### 3d

3d version, sequence length is $n^3$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-3d-l0:
      n       Tri    Tri Ca        Tor     Tor C
0   4.0  0.159995  0.167161   0.425598  0.274387
1   8.0  0.260701  0.268359   0.697578  0.371016
2  16.0  1.149982  1.176816   3.290138  1.270751
3  32.0  8.084151  8.423685  24.802711  8.866518
md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-3d-l0:
      n          Tri       Tri Ca           Tor        Tor C
0   4.0     9.003906     9.378906     24.194336     9.380371
1   8.0    72.003906    75.003906    194.517090    75.005371
2  16.0   576.003906   600.003906   1548.099121   600.005371
3  32.0  4608.003906  4800.003906  12384.755371  4800.005371
md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-3d-l0:
      n       Tri    Tri Ca        Tor     Tor C
0   4.0  0.135201  0.108522   0.088277  0.042700
1   8.0  0.160850  0.095983   0.506565  0.090944
2  16.0  1.256280  0.698969   4.004271  0.711841
3  32.0  9.996046  5.534717  31.715361  5.575314
md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-3d-l0:
      n          Tri       Tri Ca           Tor        Tor C
0   4.0    17.891406    18.266406     34.390918    18.265918
1   8.0   143.103906   146.103906    275.103418   146.103418
2  16.0  1144.803906  1168.803906   2200.803418  1168.803418
3  32.0  9158.403906  9350.403906  17606.403418  9350.403418

```

num extra token $l=10$.

```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-3d-l10:
      n       Tri    Tri Ca        Tor      Tor C
0   4.0  0.163694  0.169424   0.466343   0.267178
1   8.0  0.258779  0.273681   0.827028   0.392729
2  16.0  1.120217  1.192506   4.093866   1.672801
3  32.0  7.980970  8.432151  31.082176  11.908965
md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-3d-l10:
      n          Tri      Tri Ca           Tor        Tor C
0   4.0    10.410156    10.84375     27.600586    10.786621
1   8.0    73.410156    76.46875    196.829590    76.411621
2  16.0   577.410156   601.46875   1551.505371   601.411621
3  32.0  4609.410156  4801.46875  12388.161621  4801.411621
md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-3d-l10:
      n        Tri    Tri Ca        Tor     Tor C
0   4.0   0.124995  0.173960   0.213465  0.134794
1   8.0   0.185280  0.197958   0.701443  0.123455
2  16.0   1.381167  0.825573   5.228039  0.903560
3  32.0  10.940928  6.501355  41.288528  7.053272
md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-3d-l10:
      n          Tri       Tri Ca           Tor       Tor C
0   4.0    21.167969    21.601562     39.203418    21.54248
1   8.0   147.167969   150.226562    280.007715   150.16748
2  16.0  1155.167969  1179.226562   2205.373730  1179.16748
3  32.0  9219.167969  9411.226562  17611.567480  9411.16748
```
