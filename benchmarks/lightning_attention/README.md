# Lightning Attention with Scalar Decay

## Notation

- lasd_r: Triton recurrence
- lasd_p: Lightning attention with scalar decay
- land_p: Lightning attention with no decay
- flash: Flash attention
- lightning_p: Origin lightning attention parallel version
- lightning_c: Origin lightning attention chunk loop version

## A100

### Speed
```
lasd-speed-fwd-batch4-head32-dim128-bf16:
         n     LASD_R     LASD_P     LAND_P     LASD3P       Flash  Lightning_P  Lightning_C      GLA_K    GLA_S_K
0    256.0   0.655201   0.205039   0.193907   0.406278    0.053683     0.239480     0.206648   0.341775  0.181263
1    512.0   1.271180   0.242117   0.239736   0.511523    0.106499     0.439688     0.375008   0.514267  0.178694
2   1024.0   2.513212   0.426939   0.405114   0.491271    0.255914     0.862963     0.709685   0.967326  0.272855
3   2048.0   4.970867   0.799927   0.746659   0.837353    0.794259     1.675339     1.378064   1.873162  0.504827
4   4096.0   9.933323   1.529498   1.423880   1.584805    2.862690     3.265914     2.718649   3.734414  0.975756
5   8192.0  19.697124   2.996559   2.771016   3.089370   10.757885     6.444775     5.396883   7.485431  1.921954
6  16384.0  39.478287   5.906028   5.458594   6.110839   41.756176    12.796741    10.740829  15.172592  3.860793
7  32768.0  79.122948  11.844584  10.958596  12.396068  166.260132    25.539597    21.596392  30.867157  7.955202

lasd-speed-bwd-batch4-head32-dim128-bf16:
         n      LASD_R     LASD_P     LAND_P     LASD3P       Flash  Lightning_P  Lightning_C       GLA_K    GLA_S_K
0    256.0    3.066010   0.574184   0.588720   1.370816    0.188518     0.638128     5.907274    0.904393   0.590199
1    512.0    6.108217   0.652763   0.635101   1.509371    0.433309     1.187092    12.382326    1.713342   0.590206
2   1024.0   12.233959   1.280345   1.132465   1.600559    0.936728     2.269629    25.187744    3.313852   1.083853
3   2048.0   24.397272   2.553148   2.108330   2.997378    2.677606     4.372467    50.705151    6.504050   2.096356
4   4096.0   48.764877   4.719184   4.401410   5.673880    9.985643     8.671175   101.785919   12.950084   4.201809
5   8192.0   97.334244   9.304688   7.945391  11.098653   31.105825    17.595097   204.591431   25.792543   8.643147
6  16384.0  194.609726  18.542797  15.775350  22.035311  117.048927    35.207855   409.637848   51.738625  17.825638
7  32768.0  391.140167  36.875744  31.347425  46.832672  459.522583    70.172226   821.748108  103.733215  36.792290
```


### Memory
```
lasd-memory-fwd-batch4-head32-dim128-bf16:
         n       LASD_R       LASD_P       LAND_P       LASD3P        Flash  Lightning_P  Lightning_C         GLA_K      GLA_S_K
0    256.0    40.000488    56.000488    56.000488    56.125488    32.125977    64.000977    56.000977     88.062988    64.187988
1    512.0    72.000488   104.000488   104.000488   104.250488    64.250977   128.000977   112.000977    168.125488   120.375488
2   1024.0   136.000488   168.000488   168.000488   168.500488   128.500977   256.000977   224.000977    328.250488   232.750488
3   2048.0   264.000488   328.000488   328.000488   329.000488   257.000977   512.000977   448.000977    648.500488   457.500488
4   4096.0   520.000488   648.000488   648.000488   650.000488   514.000977  1024.000977   896.000977   1289.000488   907.000488
5   8192.0  1032.000488  1288.000488  1288.000488  1292.000488  1028.000977  2048.000977  1792.000977   2570.000488  1806.000488
6  16384.0  2056.000488  2568.000488  2568.000488  2576.000488  2056.000977  4096.000977  3584.000977   5132.000488  3604.000488
7  32768.0  4104.000488  5128.000488  5128.000488  5144.000488  4112.000977  8192.000977  7168.000977  10256.000488  7200.000488

lasd-memory-bwd-batch4-head32-dim128-bf16:
         n        LASD_R        LASD_P        LAND_P        LASD3P         Flash   Lightning_P   Lightning_C         GLA_K       GLA_S_K
0    256.0    102.800488    142.800488    142.800488    167.235352    103.050977    126.800977    111.200977    270.462988    167.172363
1    512.0    189.600488    261.600488    261.600488    310.469727    206.100977    253.600977    222.400977    532.925488    326.344238
2   1024.0    363.200488    435.200488    435.200488    532.938477    412.200977    507.200977    444.800977   1057.850488    644.687988
3   2048.0    710.400488    846.400488    846.400488   1041.875977    824.400977   1014.400977    889.600977   2107.700488   1281.375488
4   4096.0   1404.800488   1668.800488   1668.800488   2059.750977   1648.800977   2028.800977   1779.200977   4207.400488   2554.750488
5   8192.0   2793.600488   3313.600488   3313.600488   4095.500977   3297.600977   4057.600977   3558.400977   8406.800488   5101.500488
6  16384.0   5571.200488   6603.200488   6603.200488   8167.000977   6595.200977   8115.200977   7116.800977  16805.600488  10195.000488
7  32768.0  11126.400488  13182.400488  13182.400488  16310.000977  13190.400977  16230.400977  14233.600977  33603.200488  20382.000488
```
