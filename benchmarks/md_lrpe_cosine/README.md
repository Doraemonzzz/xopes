# Benchmark

## Notation

- Tri: Triton
- Tri Ca: Triton Cache
- Tri P: Triton Parallel
- Tor: Torch
- Tor C: Torch Compile

$-1$ indicate error.

## A800

### Head dim = 128 with batch size > 1

1d version, sequence length is $n$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P        Tor     Tor C
0    256.0  0.222500  0.272023  0.246396   0.388302  0.213309
1    512.0  0.249586  0.257451  0.261197   0.597553  0.324714
2   1024.0  0.305294  0.316301  0.304260   0.893999  0.430830
3   2048.0  0.427608  0.436285  0.423708   1.638786  0.703151
4   4096.0  0.699214  0.710902  0.721182   3.169919  1.268132
5   8192.0  1.152456  1.216199  1.156640   6.188838  2.387258
6  16384.0  2.104767  2.192013  2.100897  12.193980  4.634994
7  32768.0  4.054498  4.198866  4.046770  24.258072  9.199433

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-1d:
         n          Tri       Tri Ca        Tri P           Tor        Tor C
0    256.0    27.019043    28.519043    27.019043     87.022949    28.520996
1    512.0    54.019043    57.019043    54.019043    174.026855    57.022949
2   1024.0   108.019043   114.019043   108.019043    348.034668   114.026855
3   2048.0   216.019043   228.019043   216.019043    696.050293   228.034668
4   4096.0   432.019043   456.019043   432.019043   1392.081543   456.050293
5   8192.0   864.019043   912.019043   864.019043   2784.144043   912.081543
6  16384.0  1728.019043  1824.019043  1728.019043   5568.269043  1824.144043
7  32768.0  3456.019043  3648.019043  3456.019043  11136.519043  3648.269043

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P        Tor     Tor C
0    256.0  0.213283  0.242698  0.219025   0.195591  0.053820
1    512.0  0.240124  0.231895  0.237315   0.387338  0.090974
2   1024.0  0.331075  0.318591  0.329887   0.743641  0.168055
3   2048.0  0.512951  0.496727  0.522289   1.569867  0.351408
4   4096.0  0.891307  0.844823  0.893648   3.099772  0.712134
5   8192.0  1.633711  1.563278  1.628185   6.161853  1.406630
6  16384.0  3.113538  2.925087  3.116081  12.311841  2.797921
7  32768.0  6.108271  5.700977  6.105688  24.646032  5.614153

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-1d:
         n          Tri       Tri Ca        Tri P           Tor        Tor C
0    256.0    62.569043    64.069043    62.569043    128.568555    64.068555
1    512.0   125.119043   128.119043   125.119043    257.118555   128.118555
2   1024.0   250.219043   256.219043   250.219043    514.218555   256.218555
3   2048.0   500.419043   512.419043   500.419043   1028.418555   512.418555
4   4096.0  1000.819043  1024.819043  1000.819043   2056.818555  1024.818555
5   8192.0  2001.619043  2049.619043  2001.619043   4113.618555  2049.618555
6  16384.0  4003.219043  4099.219043  4003.219043   8227.218555  4099.218555
7  32768.0  8006.419043  8198.419043  8006.419043  16454.418555  8198.418555
```

2d version, sequence length is $n^2$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P        Tor     Tor C
0   16.0  0.225023  0.246338  0.287775   0.425452  0.244557
1   32.0  0.351677  0.372725  0.429558   0.932892  0.520935
2   64.0  0.841768  0.931208  1.096296   3.169070  1.193080
3  128.0  2.757247  3.018662  3.711637  12.160884  4.251587

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-2d:
       n          Tri       Tri Ca        Tri P          Tor        Tor C
0   16.0    27.003906    28.503906    27.003906    87.008789    28.504883
1   32.0   108.003906   114.003906   108.003906   348.020508   114.004883
2   64.0   432.003906   456.003906   432.003906  1392.067383   456.004883
3  128.0  1728.003906  1824.003906  1728.003906  5568.255859  1824.005859

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P        Tor     Tor C
0   16.0  0.221875  0.221801  0.209987   0.196672  0.047330
1   32.0  0.372432  0.333139  0.431516   0.743510  0.168125
2   64.0  1.054945  0.893736  1.276670   3.101311  0.712388
3  128.0  3.728806  3.114804  4.665458  12.310540  2.796198

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-2d:
       n          Tri       Tri Ca        Tri P          Tor        Tor C
0   16.0    62.553906    64.053906    62.553906   128.553418    64.053418
1   32.0   250.203906   256.203906   250.203906   514.203418   256.203418
2   64.0  1000.803906  1024.803906  1000.803906  2056.803418  1024.803418
3  128.0  4003.203906  4099.203906  4003.203906  8227.203418  4099.203418
```

3d version, sequence length is $n^3$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-3d:
      n       Tri    Tri Ca     Tri P        Tor     Tor C
0   4.0  0.217499  0.225472  0.218970   0.375117  0.269956
1   8.0  0.310074  0.330162  0.371288   0.665891  0.376577
2  16.0  1.177596  1.218097  1.631495   3.268503  1.353124
3  32.0  8.038867  8.344827 -1.000000  24.617847  9.479465

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-3d:
      n          Tri       Tri Ca       Tri P           Tor        Tor C
0   4.0  3462.755859  3463.130859  179.554004     22.131836     7.317871
1   8.0    54.003906    57.003906   54.003906    177.517090    58.505371
2  16.0   432.003906   456.003906  432.003906   1416.099121   468.005371
3  32.0  3456.003906  3648.003906   -1.000000  14784.757324  7200.007324

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-3d:
      n        Tri    Tri Ca     Tri P        Tor     Tor C
0   4.0   0.231041  0.245781  0.270991   0.070763  0.065584
1   8.0   0.303659  0.280949  0.346072   0.386963  0.099387
2  16.0   1.387275  1.054140  1.831141   3.100078  0.755692
3  32.0  10.028756  7.358363 -1.000000  24.650127  5.907206

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-3d:
      n          Tri       Tri Ca        Tri P           Tor         Tor C
0   4.0  3471.643359  3472.018359    15.641406     32.140918     16.203418
1   8.0   125.103906   128.103906   125.103906    257.103418    129.603418
2  16.0  1000.803906  1024.803906  1000.803906   2056.803418   1036.803418
3  32.0  8006.403906  8198.403906    -1.000000  19910.405371  11750.405371
```

### Head dim = 128 with batch size = 1

1d version, sequence length is $n$.
```
md_lrpe_cosine-speed-fwd-batch1-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P       Tor     Tor C
0    256.0  0.218127  0.234350  0.214261  0.271730  0.191341
1    512.0  0.234937  0.248677  0.219936  0.278065  0.210084
2   1024.0  0.224336  0.234661  0.247651  0.318123  0.207067
3   2048.0  0.225088  0.237400  0.247662  0.344440  0.208137
4   4096.0  0.234796  0.267551  0.232201  0.559106  0.230817
5   8192.0  0.266455  0.281313  0.270306  0.928596  0.324736
6  16384.0  0.348505  0.380282  0.355283  1.667764  0.517167
7  32768.0  0.517527  0.540003  0.520445  3.165998  0.920360

md_lrpe_cosine-memory-fwd-batch1-head12-dim128-bf16-1d:
         n         Tri      Tri Ca       Tri P          Tor       Tor C
0    256.0    2.269043    3.769043    2.269043    12.772949    3.770996
1    512.0    4.519043    7.519043    4.519043    25.526855    7.522949
2   1024.0    9.019043   15.019043    9.019043    51.034668   15.026855
3   2048.0   18.019043   30.019043   18.019043   102.050293   30.034668
4   4096.0   36.019043   60.019043   36.019043   204.081543   60.050293
5   8192.0   72.019043  120.019043   72.019043   408.144043  120.081543
6  16384.0  144.019043  240.019043  144.019043   816.269043  240.144043
7  32768.0  288.019043  480.019043  288.019043  1632.519043  480.269043

md_lrpe_cosine-speed-bwd-batch1-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P       Tor     Tor C
0    256.0  0.208106  0.242660  0.230149  0.041379  0.064758
1    512.0  0.229094  0.229393  0.209885  0.053043  0.021822
2   1024.0  0.214894  0.232079  0.203236  0.079321  0.038264
3   2048.0  0.208144  0.224840  0.215748  0.148090  0.044400
4   4096.0  0.203299  0.231028  0.233394  0.282468  0.076249
5   8192.0  0.269173  0.271747  0.275379  0.551598  0.138167
6  16384.0  0.384568  0.397962  0.391356  1.061226  0.258937
7  32768.0  0.648660  0.640968  0.657508  2.078648  0.508953

md_lrpe_cosine-memory-bwd-batch1-head12-dim128-bf16-1d:
         n         Tri      Tri Ca       Tri P          Tor       Tor C
0    256.0    5.231543    6.731543    5.231543    13.481055    6.731055
1    512.0   10.444043   13.444043   10.444043    26.943555   13.443555
2   1024.0   20.869043   26.869043   20.869043    53.868555   26.868555
3   2048.0   41.719043   53.719043   41.719043   107.718555   53.718555
4   4096.0   83.419043  107.419043   83.419043   215.418555  107.418555
5   8192.0  166.819043  214.819043  166.819043   430.818555  214.818555
6  16384.0  333.619043  429.619043  333.619043   861.618555  429.618555
7  32768.0  667.219043  859.219043  667.219043  1723.218555  859.218555
```

2d version, sequence length is $n^2$.
```
md_lrpe_cosine-speed-fwd-batch1-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P       Tor     Tor C
0   16.0  0.223200  0.263215  0.227575  0.315066  0.236418
1   32.0  0.222536  0.261896  0.226765  0.316911  0.249468
2   64.0  0.271293  0.262315  0.268409  0.547417  0.267362
3  128.0  0.404747  0.439900  0.493943  1.573909  0.562348

md_lrpe_cosine-memory-fwd-batch1-head12-dim128-bf16-2d:
       n         Tri      Tri Ca       Tri P         Tor       Tor C
0   16.0    2.253906    3.753906    2.253906   12.758789    3.754883
1   32.0    9.003906   15.003906    9.003906   51.020508   15.004883
2   64.0   36.003906   60.003906   36.003906  204.067383   60.004883
3  128.0  144.003906  240.003906  144.003906  816.255859  240.005859

md_lrpe_cosine-speed-bwd-batch1-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P       Tor     Tor C
0   16.0  0.212578  0.261842  0.227152  0.041888  0.054046
1   32.0  0.230000  0.248457  0.222130  0.079340  0.027727
2   64.0  0.249139  0.214731  0.230820  0.284791  0.076517
3  128.0  0.433500  0.418906  0.514771  1.060373  0.259021

md_lrpe_cosine-memory-bwd-batch1-head12-dim128-bf16-2d:
       n         Tri      Tri Ca       Tri P         Tor       Tor C
0   16.0    5.216406    6.716406    5.216406   13.465918    6.715918
1   32.0   20.853906   26.853906   20.853906   53.853418   26.853418
2   64.0   83.403906  107.403906   83.403906  215.403418  107.403418
3  128.0  333.603906  429.603906  333.603906  861.603418  429.603418
```

3d version, sequence length is $n^3$.
```
md_lrpe_cosine-speed-fwd-batch1-head12-dim128-bf16-3d:
      n       Tri    Tri Ca     Tri P       Tor     Tor C
0   4.0  0.220229  0.232729  0.232817  0.374656  0.260839
1   8.0  0.221489  0.228620  0.217351  0.363954  0.276063
2  16.0  0.268362  0.283590  0.307189  0.643490  0.324106
3  32.0  0.862880  0.886229 -1.000000  3.417714  1.245470

md_lrpe_cosine-memory-fwd-batch1-head12-dim128-bf16-3d:
      n         Tri      Tri Ca      Tri P          Tor       Tor C
0   4.0  288.568359  288.943359  14.966504     3.569336    1.130371
1   8.0    4.503906    7.503906   4.503906    28.517090    9.005371
2  16.0   36.003906   60.003906  36.003906   228.099121   72.005371
3  32.0  288.003906  480.003906  -1.000000  2112.757324  864.007324

md_lrpe_cosine-speed-bwd-batch1-head12-dim128-bf16-3d:
      n       Tri    Tri Ca     Tri P       Tor     Tor C
0   4.0  0.211262  0.219166  0.263903  0.038827  0.064791
1   8.0  0.234672  0.236521  0.254381  0.053774  0.047178
2  16.0  0.243169  0.250081  0.275591  0.283823  0.077431
3  32.0  0.979190  0.756368 -1.000000  2.079732  0.509752

md_lrpe_cosine-memory-bwd-batch1-head12-dim128-bf16-3d:
      n         Tri      Tri Ca      Tri P          Tor        Tor C
0   4.0  289.308984  289.683984   1.307031     3.369043     1.869043
1   8.0   10.428906   13.428906  10.428906    26.928418    14.928418
2  16.0   83.403906  107.403906  83.403906   215.403418   119.403418
3  32.0  667.203906  859.203906  -1.000000  2011.205371  1243.205371
```
