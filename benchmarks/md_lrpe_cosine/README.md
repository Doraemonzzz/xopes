# Benchmark

## Notation

- Tri: Triton
- Tri Ca: Triton Cache
- Tri P: Triton Parallel
- Tor: Torch
- Tor C: Torch Compile

$-1$ indicate error.

## A800

### Head dim = 128 with batch size > 1

1d version, sequence length is $n$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P        Tor     Tor C
0    256.0  0.222567  0.223663  0.222023   0.396006  0.212094
1    512.0  0.246913  0.258951  0.246647   0.566016  0.322015
2   1024.0  0.309966  0.314696  0.305050   0.896187  0.456507
3   2048.0  0.422330  0.487135  0.430520   1.648642  0.704999
4   4096.0  0.670645  0.696092  0.670253   3.167209  1.271631
5   8192.0  1.150657  1.197092  1.148619   6.180195  2.389709
6  16384.0  2.111613  2.188148  2.140262  12.251084  4.665602
7  32768.0  4.068692  4.188337  4.072089  24.253281  9.220687

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-1d:
         n          Tri       Tri Ca        Tri P           Tor        Tor C
0    256.0    27.019043    28.519043    27.019043     87.022949    28.520996
1    512.0    54.019043    57.019043    54.019043    174.026855    57.022949
2   1024.0   108.019043   114.019043   108.019043    348.034668   114.026855
3   2048.0   216.019043   228.019043   216.019043    696.050293   228.034668
4   4096.0   432.019043   456.019043   432.019043   1392.081543   456.050293
5   8192.0   864.019043   912.019043   864.019043   2784.144043   912.081543
6  16384.0  1728.019043  1824.019043  1728.019043   5568.269043  1824.144043
7  32768.0  3456.019043  3648.019043  3456.019043  11136.519043  3648.269043

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P        Tor     Tor C
0    256.0  0.227719  0.213560  0.208358   0.195299  0.046441
1    512.0  0.236225  0.237397  0.235645   0.387595  0.090702
2   1024.0  0.328690  0.323785  0.327729   0.743017  0.168182
3   2048.0  0.532215  0.525606  0.515339   1.569411  0.351861
4   4096.0  0.888895  0.845268  0.889463   3.100652  0.711869
5   8192.0  1.641824  1.539061  1.632343   6.162762  1.406448
6  16384.0  3.112973  2.931130  3.106830  12.314024  2.797656
7  32768.0  6.110848  5.707336  6.107688  24.652168  5.612322

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-1d:
         n          Tri       Tri Ca        Tri P           Tor        Tor C
0    256.0    62.569043    64.069043    62.569043    128.568555    64.068555
1    512.0   125.119043   128.119043   125.119043    257.118555   128.118555
2   1024.0   250.219043   256.219043   250.219043    514.218555   256.218555
3   2048.0   500.419043   512.419043   500.419043   1028.418555   512.418555
4   4096.0  1000.819043  1024.819043  1000.819043   2056.818555  1024.818555
5   8192.0  2001.619043  2049.619043  2001.619043   4113.618555  2049.618555
6  16384.0  4003.219043  4099.219043  4003.219043   8227.218555  4099.218555
7  32768.0  8006.419043  8198.419043  8006.419043  16454.418555  8198.418555

```

2d version, sequence length is $n^2$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P        Tor     Tor C
0   16.0  0.220462  0.237653  0.244817   0.457305  0.242837
1   32.0  0.345685  0.369238  0.403259   0.920161  0.483153
2   64.0  0.830322  0.911554  1.074407   3.176598  1.294789
3  128.0  2.753371  3.067942  3.702125  12.143805  4.256078

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-2d:
       n          Tri       Tri Ca        Tri P          Tor        Tor C
0   16.0    27.003906    28.503906    27.003906    87.008789    28.504883
1   32.0   108.003906   114.003906   108.003906   348.020508   114.004883
2   64.0   432.003906   456.003906   432.003906  1392.067383   456.004883
3  128.0  1728.003906  1824.003906  1728.003906  5568.255859  1824.005859

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P        Tor     Tor C
0   16.0  0.217929  0.224479  0.216295   0.195383  0.056656
1   32.0  0.367813  0.378382  0.429665   0.742846  0.168171
2   64.0  1.038121  0.863242  1.284005   3.100771  0.712346
3  128.0  3.689505  3.140484  4.679237  12.313135  2.795895

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-2d:
       n          Tri       Tri Ca        Tri P          Tor        Tor C
0   16.0    62.553906    64.053906    62.553906   128.553418    64.053418
1   32.0   250.203906   256.203906   250.203906   514.203418   256.203418
2   64.0  1000.803906  1024.803906  1000.803906  2056.803418  1024.803418
3  128.0  4003.203906  4099.203906  4003.203906  8227.203418  4099.203418

```

3d version, sequence length is $n^3$.
```
md_lrpe_cosine-speed-fwd-batch12-head12-dim128-bf16-3d:
      n       Tri    Tri Ca     Tri P        Tor     Tor C
0   4.0  0.220939  0.245775  0.225163   0.417399  0.259806
1   8.0  0.316307  0.330730  0.368392   0.703144  0.379502
2  16.0  1.215222  1.268481  1.641280   3.272854  1.355353
3  32.0  8.102109  8.322237 -1.000000  24.616087  9.477472

md_lrpe_cosine-memory-fwd-batch12-head12-dim128-bf16-3d:
      n          Tri       Tri Ca       Tri P           Tor        Tor C
0   4.0  3462.755859  3463.130859  179.554004     22.131836     7.317871
1   8.0    54.003906    57.003906   54.003906    177.517090    58.505371
2  16.0   432.003906   456.003906  432.003906   1416.099121   468.005371
3  32.0  3456.003906  3648.003906   -1.000000  14784.757324  7200.007324

md_lrpe_cosine-speed-bwd-batch12-head12-dim128-bf16-3d:
      n        Tri    Tri Ca     Tri P        Tor     Tor C
0   4.0   0.289850  0.256184  0.240836   0.062472  0.044814
1   8.0   0.294799  0.235807  0.365925   0.388227  0.099393
2  16.0   1.385704  0.862273  1.843859   3.099437  0.755549
3  32.0  10.001977  5.688426 -1.000000  24.647015  5.909566

md_lrpe_cosine-memory-bwd-batch12-head12-dim128-bf16-3d:
      n          Tri       Tri Ca        Tri P           Tor         Tor C
0   4.0  3471.643359  3472.018359    15.641406     32.140918     16.203418
1   8.0   125.103906   128.103906   125.103906    257.103418    129.603418
2  16.0  1000.803906  1024.803906  1000.803906   2056.803418   1036.803418
3  32.0  8006.403906  8198.403906    -1.000000  19910.405371  11750.405371

```

### Head dim = 128 with batch size = 1

1d version, sequence length is $n$.
```
md_lrpe_cosine-speed-fwd-batch1-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P       Tor     Tor C
0    256.0  0.223889  0.246473  0.228587  0.298113  0.192030
1    512.0  0.220712  0.245934  0.224986  0.279371  0.208558
2   1024.0  0.222714  0.291639  0.222673  0.279094  0.208431
3   2048.0  0.225946  0.241346  0.219058  0.336869  0.205734
4   4096.0  0.292415  0.244353  0.230297  0.542950  0.226099
5   8192.0  0.267311  0.284118  0.271559  0.934426  0.321713
6  16384.0  0.358674  0.367862  0.416032  1.681181  0.515402
7  32768.0  0.518696  0.533011  0.538656  3.162524  0.935123

md_lrpe_cosine-memory-fwd-batch1-head12-dim128-bf16-1d:
         n         Tri      Tri Ca       Tri P          Tor       Tor C
0    256.0    2.269043    3.769043    2.269043    12.772949    3.770996
1    512.0    4.519043    7.519043    4.519043    25.526855    7.522949
2   1024.0    9.019043   15.019043    9.019043    51.034668   15.026855
3   2048.0   18.019043   30.019043   18.019043   102.050293   30.034668
4   4096.0   36.019043   60.019043   36.019043   204.081543   60.050293
5   8192.0   72.019043  120.019043   72.019043   408.144043  120.081543
6  16384.0  144.019043  240.019043  144.019043   816.269043  240.144043
7  32768.0  288.019043  480.019043  288.019043  1632.519043  480.269043

md_lrpe_cosine-speed-bwd-batch1-head12-dim128-bf16-1d:
         n       Tri    Tri Ca     Tri P       Tor     Tor C
0    256.0  0.222275  0.224734  0.256308  0.041877  0.065512
1    512.0  0.214666  0.274086  0.242611  0.054796  0.059004
2   1024.0  0.222214  0.234189  0.242535  0.080964  0.051417
3   2048.0  0.214691  0.279340  0.212611  0.148378  0.044905
4   4096.0  0.241644  0.232721  0.210749  0.283469  0.076500
5   8192.0  0.263844  0.274229  0.266988  0.552208  0.139856
6  16384.0  0.389093  0.401581  0.395545  1.061219  0.259507
7  32768.0  0.635668  0.640835  0.652163  2.080590  0.509478

md_lrpe_cosine-memory-bwd-batch1-head12-dim128-bf16-1d:
         n         Tri      Tri Ca       Tri P          Tor       Tor C
0    256.0    5.231543    6.731543    5.231543    13.481055    6.731055
1    512.0   10.444043   13.444043   10.444043    26.943555   13.443555
2   1024.0   20.869043   26.869043   20.869043    53.868555   26.868555
3   2048.0   41.719043   53.719043   41.719043   107.718555   53.718555
4   4096.0   83.419043  107.419043   83.419043   215.418555  107.418555
5   8192.0  166.819043  214.819043  166.819043   430.818555  214.818555
6  16384.0  333.619043  429.619043  333.619043   861.618555  429.618555
7  32768.0  667.219043  859.219043  667.219043  1723.218555  859.218555

```

2d version, sequence length is $n^2$.
```
md_lrpe_cosine-speed-fwd-batch1-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P       Tor     Tor C
0   16.0  0.246285  0.233213  0.247452  0.302020  0.225223
1   32.0  0.233361  0.239734  0.232500  0.320295  0.340477
2   64.0  0.247971  0.266817  0.265916  0.543853  0.282350
3  128.0  0.404440  0.436471  0.483921  1.578406  0.552702

md_lrpe_cosine-memory-fwd-batch1-head12-dim128-bf16-2d:
       n         Tri      Tri Ca       Tri P         Tor       Tor C
0   16.0    2.253906    3.753906    2.253906   12.758789    3.754883
1   32.0    9.003906   15.003906    9.003906   51.020508   15.004883
2   64.0   36.003906   60.003906   36.003906  204.067383   60.004883
3  128.0  144.003906  240.003906  144.003906  816.255859  240.005859

md_lrpe_cosine-speed-bwd-batch1-head12-dim128-bf16-2d:
       n       Tri    Tri Ca     Tri P       Tor     Tor C
0   16.0  0.217898  0.240743  0.259111  0.042514  0.039329
1   32.0  0.224910  0.250440  0.232611  0.079454  0.057072
2   64.0  0.250044  0.244620  0.243087  0.283907  0.076542
3  128.0  0.463785  0.399869  0.521422  1.059291  0.258872

md_lrpe_cosine-memory-bwd-batch1-head12-dim128-bf16-2d:
       n         Tri      Tri Ca       Tri P         Tor       Tor C
0   16.0    5.216406    6.716406    5.216406   13.465918    6.715918
1   32.0   20.853906   26.853906   20.853906   53.853418   26.853418
2   64.0   83.403906  107.403906   83.403906  215.403418  107.403418
3  128.0  333.603906  429.603906  333.603906  861.603418  429.603418

```

3d version, sequence length is $n^3$.
```
md_lrpe_cosine-speed-fwd-batch1-head12-dim128-bf16-3d:
      n       Tri    Tri Ca     Tri P       Tor     Tor C
0   4.0  0.239936  0.238963  0.228518  0.461456  0.254904
1   8.0  0.219509  0.234882  0.289104  0.387680  0.321160
2  16.0  0.270764  0.304190  0.316825  0.668664  0.320707
3  32.0  0.863140  0.916388 -1.000000  3.407869  1.255792

md_lrpe_cosine-memory-fwd-batch1-head12-dim128-bf16-3d:
      n         Tri      Tri Ca      Tri P          Tor       Tor C
0   4.0  288.568359  288.943359  14.966504     3.569336    1.130371
1   8.0    4.503906    7.503906   4.503906    28.517090    9.005371
2  16.0   36.003906   60.003906  36.003906   228.099121   72.005371
3  32.0  288.003906  480.003906  -1.000000  2112.757324  864.007324

md_lrpe_cosine-speed-bwd-batch1-head12-dim128-bf16-3d:
      n       Tri    Tri Ca     Tri P       Tor     Tor C
0   4.0  0.231254  0.227256  0.227876  0.036059  0.069909
1   8.0  0.226036  0.235239  0.212001  0.053261  0.078775
2  16.0  0.239366  0.234414  0.280336  0.283388  0.076945
3  32.0  0.969826  0.653521 -1.000000  2.080771  0.509396

md_lrpe_cosine-memory-bwd-batch1-head12-dim128-bf16-3d:
      n         Tri      Tri Ca      Tri P          Tor        Tor C
0   4.0  289.308984  289.683984   1.307031     3.369043     1.869043
1   8.0   10.428906   13.428906  10.428906    26.928418    14.928418
2  16.0   83.403906  107.403906  83.403906   215.403418   119.403418
3  32.0  667.203906  859.203906  -1.000000  2011.205371  1243.205371
```
